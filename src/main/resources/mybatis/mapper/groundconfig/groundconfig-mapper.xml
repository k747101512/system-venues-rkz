<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cm.venuebooking.dao.groundconfig.IGroundConfigDao">

    <resultMap id="groundInfoDTO" type="com.cm.venuebooking.pojo.dtos.groundconfig.GroundInfoDTO">
        <id column="ground_info_id" property="groundInfoId"/>
        <result column="venues_project_id" property="venuesProjectId"/>
        <result column="ground_name" property="groundName"/>
        <result column="ground_location" property="groundLocation"/>
        <result column="open_close_type" property="openCloseType"/>
    </resultMap>

    <resultMap id="groundConfigDTO" type="com.cm.venuebooking.pojo.dtos.groundconfig.GroundConfigDTO">
        <id column="ground_config_id" property="groundConfigId"/>
        <result column="ground_info_id" property="groundInfoId"/>
        <result column="week" property="week"/>
        <result column="order_index" property="orderIndex"/>
        <result column="time_am_str" property="timeAMStr"/>
        <result column="time_am_end" property="timeAMEnd"/>
        <result column="time_pm_str" property="timePMStr"/>
        <result column="time_pm_end" property="timePMEnd"/>
        <result column="length_time" property="lengthTime"/>
        <result column="rest_time" property="restTime"/>
        <result column="single_price" property="singlePrice"/>
    </resultMap>


    <!-- 新增场馆信息表 -->
    <insert id="saveGroundInfo" parameterType="map">
        INSERT INTO gen_ground_info (
            ground_info_id,
            venues_project_id,
            ground_name,
            ground_location,
            open_close_type,
            creator,
            gmt_create,
            modifier,
            gmt_modified,
            is_delete
        ) VALUES(
            #{groundInfoId},
            #{venuesProjectId},
            #{groundName},
            #{groundLocation},
            #{openCloseType},
            #{creator},
            #{gmtCreate},
            #{modifier},
            #{gmtModified},
            #{isDelete}
        )
    </insert>

    <insert id="saveGroundConfig" parameterType="map">
        INSERT INTO gen_ground_config (
            ground_config_id,
            ground_info_id,
            venues_project_id,
            week,
            order_index,
            time_am_str,
            time_am_end,
            time_pm_str,
            time_pm_end,
            length_time,
            rest_time,
            single_price,
            creator,
            gmt_create,
            modifier,
            gmt_modified,
            is_delete
        ) VALUES(
            #{groundConfigId},
            #{groundInfoId},
            #{venuesProjectId},
            #{week},
            #{orderIndex},
            #{timeAMStr},
            #{timeAMEnd},
            #{timePMStr},
            #{timePMEnd},
            #{lengthTime},
            #{restTime},
            #{singlePrice},
            #{creator},
            #{gmtCreate},
            #{modifier},
            #{gmtModified},
            #{isDelete}
        )
    </insert>

    <!-- 更新场地信息-->
    <update id="updateGroundInfo" parameterType="map">
        UPDATE
            gen_ground_info
        SET
            <if test="groundName != null and groundName != ''">
                ground_name = #{groundName},
            </if>
            <if test="groundLocation != null and groundLocation != ''">
                ground_location = #{groundLocation},
            </if>
            <if test="openCloseType != null and openCloseType != ''">
                open_close_type = #{openCloseType},
            </if>
                modifier = #{modifier},
                gmt_modified = #{gmtModified}
        WHERE
            ground_info_id = #{groundInfoId}
    </update>

    <select id="getGroundInfo" parameterType="map" resultMap="groundInfoDTO">
        select
            t1.ground_info_id,
            t1.venues_project_id,
            t1.ground_name,
            t1.ground_location,
            t1.open_close_type
        from
            gen_ground_info t1
        where
            t1.is_delete = 0
        <if test="groundInfoId != null and groundInfoId != ''">
        AND
            t1.ground_info_id = #{groundInfoId}
        </if>
    </select>

    <select id="listGroundInfoByProject" parameterType="map" resultMap="groundInfoDTO">
        select
            t1.ground_info_id,
            t1.venues_project_id,
            t1.ground_name,
            t1.ground_location,
            t1.open_close_type
        from
            gen_ground_info t1
        where
            t1.is_delete = 0
        <if test="venuesProjectId != null and venuesProjectId != ''">
            AND
            t1.venues_project_id = #{venuesProjectId}
        </if>
    </select>

    <!-- 删除场地-->
    <update id="removeGroundInfo" parameterType="map">
        UPDATE
            gen_ground_info
        SET
            is_delete = 1,
            modifier = #{modifier},
            gmt_modified = #{gmtModified}
        WHERE
            ground_info_id IN
        <foreach collection="groundInfoIds" index="index" open="(" separator="," close=")">
            #{groundInfoIds[${index}]}
        </foreach>
    </update>

    <!-- 场地信息表分页列表-->
    <select id="listGroundInfo" parameterType="map" resultMap="groundInfoDTO">
        SELECT
            t1.ground_info_id,
            t1.venues_project_id,
            t1.ground_name,
            t1.ground_location,
            t1.open_close_type
        FROM
            gen_ground_info t1
        WHERE
            t1.is_delete = 0
        <if test="venuesProjectId != null and venuesProjectId != ''">
            AND
            t1.venues_project_id = #{venuesProjectId}
        </if>
        <if test="keywords != null and keywords != ''">
            <!-- 这里添加检索关键字 -->
        </if>
    </select>

    <!--根据场地ID查询对应配置列表-->
    <select id="getGroundConfig" parameterType="map" resultMap="groundConfigDTO">
        SELECT
            t1.ground_config_id,
            t1.ground_info_id,
            t1.week,
            t1.order_index,
            t1.time_am_str,
            t1.time_am_end,
            t1.time_pm_str,
            t1.time_pm_end,
            t1.length_time,
            t1.rest_time,
            t1.single_price
        FROM
            gen_ground_config t1
        WHERE
            t1.is_delete = 0
        AND t1.ground_info_id = #{groundInfoId}
        ORDER BY
            t1.order_index ASC
    </select>

    <!-- 删除场地配置信息-->
    <delete id="removeGroundDailyInfo" parameterType="map">
        DELETE FROM
            gen_ground_config
        WHERE
            ground_info_id IN
        <foreach collection="groundInfoIds" index="index" open="(" separator="," close=")">
            #{groundInfoIds[${index}]}
        </foreach>
    </delete>

</mapper>